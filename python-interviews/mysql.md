<!--
 * @Author: your name
 * @Date: 2020-08-20 09:57:13
 * @LastEditTime: 2020-08-20 11:48:06
 * @LastEditors: Please set LastEditors
 * @Description: In User Settings Edit
 * @FilePath: \算法\python-interviews\mysql.md
-->
## redo log, binlog, undo log
- redo log
  - 定义：通常是物理日志，记录的是数据页的物理修改，它用来恢复提交后的物理数据页(恢复数据页，且只能恢复到最后一次提交的位置)。 
  - 作用: 确保事务的持久性。防止在发生故障的时间点，尚有脏页未写入磁盘，在重启mysql服务的时候，根据redo log进行重做，从而达到事务的持久性这一特性。
  - 什么时候产生：事务开始之后就产生redo log，redo log的落盘并不是随着事务的提交才写入的，而是在事务的执行过程中，便开始写入redo log文件中。
  - 什么时候释放：当对应事务的脏页写入到磁盘之后，redo log的使命也就完成了，重做日志占用的空间就可以重用（被覆盖）。
- undo log
  - 定义：用来回滚行记录到某个版本。undo log一般是逻辑日志，根据每行记录进行记录。
  - 作用：保存了事务发生之前的数据的一个版本，可以用于回滚，同时可以提供多版本并发控制下的读（MVCC），也即非锁定读
  - 什么时候产生：事务开始之前，将当前是的版本生成undo log，undo 也会产生 redo 来保证undo log的可靠性
  - 什么时候释放：当事务提交之后，undo log并不能立马被删除，而是放入待清理的链表，由purge线程判断是否由其他事务在使用undo段中表的上一个事务之前的版本信息，决定是否可以清理undo log的日志空间。
- bin log
  - 逻辑格式的日志，可以简单认为就是执行过的事务中的sql语句。
  - 作用：用于复制，在主从复制中，从库利用主库上的binlog重放，实现主从同步。 用于数据库的基于时间点的还原。
  - 产生：binlog是在事务提交的时候一次性写入的造成的
  - 释放：binlog的默认是保持时间由参数expire_logs_days配置，也就是说对于非活动的日志文件，在生成时间超过expire_logs_days配置的天数之后，会被自动删除。

## 索引

- 索引目的
  - 索引的目的在于提高查询效率

- 索引原理
  - 通过同一种查找方式来锁定数据。
  - 等值查询，还有范围查询(>、<、between、in)、模糊查询(like)、并集查询(or)等等。
  
- 磁盘IO与预读
  - 考虑到磁盘IO是非常高昂的操作，计算机操作系统做了一些优化，当一次IO时，不光把当前磁盘地址的数据，而是把相邻的数据也都读取到内存缓冲区内，因为局部预读性原理告诉我们，当计算机访问一个地址的数据的时候，与其相邻的数据也会很快被访问到。每一次IO读取的数据我们称之为一页(page)。具体一页有多大数据跟操作系统有关，一般为4k或8k，也就是我们读取一页内的数据时候，实际上才发生了一次IO，这个理论对于索引的数据结构设计非常有帮助。

- btree数据块
- ![btree数据块](file:///C:\Users\Lenovo\Desktop\算法\python-interviews\btree数据块.jpg "数据块")

